@model EasyPro.Models.ExcelDumpSupReg
    <style>
        #customers {
            font-family: Arial, Helvetica, sans-serif;
            border-collapse: collapse;
            width: 100%;
        }

            #customers td, #customers th {
                border: 1px solid #ddd;
                padding: 8px;
            }

            #customers tr:nth-child(even) {
                background-color: #f2f2f6;
            }

            #customers tr:hover {
                background-color: #c3d8eb;
            }

            #customers th {
                padding-top: 12px;
                padding-bottom: 12px;
                text-align: left;
                background-color: #dec3eb;
                color: white;
            }

        .divScroll {
            width: 1110px;
            height: 200px;
            overflow: auto;
        }
    </style>
    <div class="row">
        <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
            <div class="form-element-list mg-t-30">
                <div class="cmp-tb-hd">
                    <h2>Import</h2>
                </div>
                <hr />
                <form asp-action="RegApprove">
                    <div asp-validation-summary="ModelOnly" class="text-danger"></div>
                    <div class="row">
                    </div>
                    <div class="row">
                        <div class="col-lg-6 col-md-6 col-sm-6 col-xs-12">
                            
                        </div>
                        <div class="col-lg-6 col-md-6 col-sm-6 col-xs-12">
                            <div class="form-group">
                                <label class="control-label">Society Name</label>
                                <select id="scode" class="form-control" asp-items="@ViewBag.scode" required>
                                    <option value=""></option>
                                </select>
                                <span asp-validation-for="SaccoCode" class="text-danger"></span>
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-4">
                            <input type="file" id="fileupload" name="files" class="form-control" />
                        </div>
                        <div class="col-md-3">
                            <a name="Upload" id="btnupload" class="btn btn-primary">Upload</a>
                        </div>
                    </div>
                    <div class="clearfix">&nbsp;</div>

                    <div class="row">
                        <div class="bsc-tbl-hvr table-border-style">
                            <div class="table-responsive">
                                <div class="divScroll">
                                    <div id="divPrint"></div>
                                </div>
                            </div>
                        </div>

                    </div>
                    <div class="row">
                        <div class="col-md-3">
                            <a asp-action="RegDownload" class="btn btn-info">Download</a>
                        </div>
                        <div class="col-md-3">
                            <a asp-action="RegApprove" name="Approve" id="btnapprove" class="btn btn-primary">Approve</a>
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </div>


    @section Scripts {
        @{
            await Html.RenderPartialAsync("_ValidationScriptsPartial");
        }
        <script type="text/javascript">
            $(function () {
                $('#btnapprove').on('click', function () {
                    var scode = $('#scode').val();
                    checkdefaults();
                    $.ajax(
                        {
                            type: 'POST',
                            url: "/ExcelUpload/RegApprove?scodes=" + scode,
                            contentType: 'application/json',
                            success: function (response) {
                                if (response) {
                                    alert("Record uploaded successfully.");
                                    return false;
                                } else {
                                    alert("Some error occured while uploading.");
                                    return false;
                                }
                            },
                            failure: function (response) {
                            }
                        }).then(function () {

                        });
                });
                function checkdefaults() {
                    var fileExtension = ['xls', 'xlsx'];
                    var filename = $('#fileupload').val();
                    if (filename.length == 0) {
                        alert("Please select a file.");
                        return false;
                    }
                    else {
                        var extension = filename.replace(/^.*\./, '');
                        if ($.inArray(extension, fileExtension) == -1) {
                            alert("Please select only excel files.");
                            return false;
                        }
                    }
                }
                $('#btnupload').on('click', function () {
                    checkdefaults();

                    var fdata = new FormData();
                    var fileUpload = $("#fileupload").get(0);
                    var scode = $("#scode").val();
                    var files = fileUpload.files;
                    fdata.append(files[0].name, files[0]);
                    $.ajax({
                        type: "POST",
                        url: "/ExcelUpload/RegImport?scodes=" + scode,
                        beforeSend: function (xhr) {
                            xhr.setRequestHeader("XSRF-TOKEN",
                                $('input:hidden[name="__RequestVerificationToken"]').val());
                        },
                        data: fdata,
                        contentType: false,
                        processData: false,
                        success: function (response) {
                            if (response.length == 0)
                                alert('Some error occured while uploading');
                            else {
                                $('#divPrint').html(response);
                            }
                        },
                        error: function (e) {
                            $('#divPrint').html(e.responseText);
                        }
                    });
                })
            });
        </script>
    }


