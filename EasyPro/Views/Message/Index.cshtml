@model EasyPro.Models.Message

<div class="row">
    <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
        <div class="form-element-list mg-t-30">
            <div class="cmp-tb-hd">
                <h2>Send SMS</h2>
            </div>
            <hr />
            <form asp-action="Create">
                <div asp-validation-summary="ModelOnly" class="text-danger"></div>
                <div class="row">
                    <div class="col-sm-4 col-xs-12">
                        <div class="form-group">
                            <input name="farmers" type="radio" id="all-farmers" />
                            <label class="control-label" for="all-farmers">All Farmers</label>
                        </div>
                        <div class="form-group">
                            <input name="farmers" type="radio" id="active-farmers" />
                            <label class="control-label" for="active-farmers">Active Farmers</label>
                        </div>
                        <div class="form-group">
                            <input name="farmers" type="radio" id="specific-location" />
                            <label class="control-label" for="specific-location">Specific Location</label>
                        </div>
                        <div class="form-group">
                            <input name="farmers" type="radio" id="individual" />
                            <label class="control-label" for="individual">Phone No.</label>
                        </div>
                    </div>
                    
                    <div class="col-sm-8 col-xs-12">
                        <div id="all-farmers-details"></div>
                        <div class="row" id="active-farmers-details">
                            <div class="row">
                                <div class="col-sm-6 col-xs-12">
                                    <div class="form-group">
                                        <label class="control-label">For Period Ending</label>
                                        <input id="processTime" asp-for="ProcessTime" class="form-control" type="date" />
                                        <span asp-validation-for="ProcessTime" class="text-danger"></span>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="row" id="specific-location-details">
                            <div class="row">
                                <div class="col-sm-6 col-xs-12">
                                    <div class="form-group">
                                        <label class="control-label">Locations</label>
                                        <select id="location" class="form-control" asp-items="@ViewBag.locations">
                                            <option value="" disabled selected hidden>Please Choose...</option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                        </div>

                         <div class="row" id="individual-details">
                            <div class="row">
                                <div class="col-xs-12">
                                    <div class="form-group">
                                        <label class="control-label">Phone No.</label>
                                        <input id="phone" autocomplete="off" class="form-control" />
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="row">
                    <div class="col-sm-6 col-xs-12">
                        <div class="form-group">
                            <label class="control-label">Message To Send</label>
                            <textarea id="message" rows="3" autocomplete="off" class="form-control"></textarea>
                        </div>
                    </div>
                </div>

                <div class="row">
                    <div class="col-lg-4 col-md-4 col-sm-4 col-xs-12">
                        <a id="save" class="btn btn-success">Save</a>
                    </div>
                </div>
            </form>
        </div>
    </div>
</div>


@section Scripts {
    @{
        await Html.RenderPartialAsync("_ValidationScriptsPartial");
    }
<script type="text/javascript">
    $(function () {
        var today = new Date().toISOString().split('T')[0];
        $("#processTime").val(today);
        let recipient = 1;
        $('#all-farmers').prop('checked', true);
        $('#active-farmers-details').hide();
        $('#specific-location-details').hide();
        $('#individual-details').hide();
        $('input[type="radio"]').click(function () {
            if ($(this).prop("checked") && $(this).attr('id') == 'all-farmers') {
                recipient = 1;
                $('#all-farmers-details').show();
                $('#active-farmers-details').hide();
                $('#specific-location-details').hide();
                $('#individual-details').hide();
            }
            if ($(this).prop("checked") && $(this).attr('id') == 'active-farmers') {
                recipient = 2;
                $('#all-farmers-details').hide();
                $('#active-farmers-details').show();
                $('#specific-location-details').hide();
                $('#individual-details').hide();
            }
            if ($(this).prop("checked") && $(this).attr('id') == 'specific-location') {
                recipient = 3;
                $('#all-farmers-details').hide();
                $('#active-farmers-details').hide();
                $('#specific-location-details').show();
                $('#individual-details').hide();
            }
            if ($(this).prop("checked") && $(this).attr('id') == 'individual') {
                recipient = 4;
                $('#all-farmers-details').hide();
                $('#active-farmers-details').hide();
                $('#specific-location-details').hide();
                $('#individual-details').show();
            }
        });

        $('#save').on('click', function () {
            $.ajax({
                type: 'POST',
                url: "SmpPosting",
                contentType: 'application/json',
                data: JSON.stringify({ 
                    content: $("#message").val(),
                    telNo: $("#phone").val(),
                    periodEnding: $("#processTime").val(),
                    location: $("#location").val(),
                    recipient: recipient
                }),
                success: function (response) {
                    $("#message").val('');
                    $("#phone").val('');
                    $("#location").val('');
                    $("#processTime").val(today);
                },
                failure: function (response) {
                }
            }).then(function () {
                // ...
            });
        });
    });
</script>
}
