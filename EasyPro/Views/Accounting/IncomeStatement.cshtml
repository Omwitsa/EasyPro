<div class="row">
    <div class="tabs-info-area">
        <div class="container">
            <div class="row">
                <div class="col-sm-12 col-xs-12">
                    <div class="widget-tabs-int">
                        <div class="tab-hd">
                            <h3 class="text-danger fa-bold">Income Statement</h3>
                        </div>
                        <div class="widget-tabs-list">
                            <div class="row">
                                <div class="col-sm-2 col-xs-12">
                                    <div class="form-group">
                                        <label class="control-label">From Date</label>
                                        <input type="date" id="fromDate" class="form-control" />
                                    </div>
                                </div>
                                <div class="col-sm-2 col-xs-12">
                                    <div class="form-group">
                                        <label class="control-label">To Date</label>
                                        <input type="date" id="toDate" class="form-control" />
                                    </div>
                                </div>
                                <div class="col-sm-2 col-xs-12">
                                    @*<a id="endOfDay" class="btn btn-success">Intake End Of Day</a>*@
                                </div>
                                <div class="col-sm-2 col-xs-12">
                                   @* <label class="control-label">Product</label>
                                    <select id="product" class="chzn-select form-control" asp-items="@ViewBag.products">
                                        <option value=""></option>
                                    </select>*@
                                </div>
                            </div>

                            <ul class="nav nav-tabs">
                                <li class="active"><a data-toggle="tab" href="#generalStatement">General</a></li>
                                <li><a data-toggle="tab" href="#storeStatement">Store</a></li>
                                <li><a data-toggle="tab" href="#yoghurtStatement">Yoghurt</a></li>
                                <li><a data-toggle="tab" href="#tankerStatement">Tanker</a></li>
                                <li><a data-toggle="tab" href="#aiStatement">A.I</a></li>
                            </ul>
                            <div class="tab-content tab-custom-st">
                                <div id="generalStatement" class="tab-pane fade in active">
                                    <div class="widget-tabs-int">
                                        <div class="widget-tabs-list">
                                            <ul class="nav nav-tabs">
                                                <li class="active"><a data-toggle="tab" href="#generalStatSummary">Summary</a></li>
                                                <li><a data-toggle="tab" href="#generalStatDetailed">Detailed</a></li>
                                            </ul>

                                            <div class="tab-content tab-custom-st">
                                                <div id="generalStatSummary" class="tab-pane fade in active">
                                                    <div class="tab-ctn">
                                                        <div class="normal-table-list mg-t-30">
                                                            <div class="row">
                                                                <div class="col-sm-4 col-xs-12">
                                                                    <a id="btn_gen_stat_summary" class="btn btn-warning">Show</a>
                                                                </div>
                                                                <div class="col-sm-4 col-xs-12">
                                                                    <a id="excel_rep_gen_summary" class="btn btn-success">Export Excel</a>
                                                                </div>
                                                            </div>
                                                            
                                                            <div class="bsc-tbl-hvr table-border-style">
                                                                <div class="table-responsive">
                                                                    <table class="table table-hover">
                                                                        <thead>
                                                                            <tr>
                                                                                <th>
                                                                                    Name
                                                                                </th>
                                                                                <th>
                                                                                    Quantity
                                                                                </th>
                                                                                <th>
                                                                                    Price
                                                                                </th>
                                                                                <th>
                                                                                    Amount
                                                                                </th>
                                                                            </tr>
                                                                        </thead>
                                                                        <tbody id="gen_rep_summary">
                                                                        </tbody>
                                                                    </table>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div id="generalStatDetailed" class="tab-pane fade">
                                                    <div class="tab-ctn">
                                                        <div class="normal-table-list mg-t-30">
                                                            <div class="row">
                                                                <div class="col-sm-4 col-xs-12">
                                                                    <a id="btn_general_detailed" class="btn btn-warning">Show</a>
                                                                </div>
                                                                <div class="col-sm-4 col-xs-12">
                                                                    <a id="excel_general_detailed" class="btn btn-success">Export Excel</a>
                                                                </div>
                                                            </div>

                                                            <div class="bsc-tbl-hvr table-border-style">
                                                                <div class="table-responsive">
                                                                    <table class="table table-hover">
                                                                        <thead>
                                                                            <tr>
                                                                                <th>
                                                                                    Date
                                                                                </th>
                                                                                <th>
                                                                                    Gl Acc
                                                                                </th>
                                                                                <th>
                                                                                    Acc Name
                                                                                </th>
                                                                                <th>
                                                                                    Description
                                                                                </th>
                                                                                <th>
                                                                                    Dr
                                                                                </th>
                                                                                <th>
                                                                                    Cr
                                                                                </th>
                                                                            </tr>
                                                                        </thead>
                                                                        <tbody id="general_detailed">
                                                                        </tbody>
                                                                    </table>
                                                                </div>
                                                                
                                                                <div class="row">
                                                                    <div class="col-sm-4 col-xs-12">
                                                                    </div>
                                                                    <div class="col-sm-4 col-xs-12">
                                                                        <label class="control-label">Total SPrice</label>
                                                                        <input value="0" id="Tselling" class="form-control" readonly />
                                                                    </div>
                                                                    <div class="col-sm-4 col-xs-12">
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <div id="storeStatement" class="tab-pane fade">
                                    <div class="tab-ctn">
                                        <div class="normal-table-list mg-t-30">
                                            <div class="row">
                                                <div class="col-sm-4 col-xs-12">
                                                    <a id="showSummery" class="btn btn-warning">Show</a>
                                                </div>
                                                <div class="col-sm-4 col-xs-12">
                                                    <a id="excel_summery" class="btn btn-success">Export Excel</a>
                                                </div>
                                            </div>

                                            <div class="bsc-tbl-hvr table-border-style">
                                                <div class="table-responsive">
                                                    <div class="divScroll">
                                                        <table class="table table-hover" id="tbl_summary">
                                                            <tr>
                                                                <th>Date</th>
                                                                <th>Code</th>
                                                                <th>Product</th>
                                                                <th>SNo</th>
                                                                <th>Quantity</th>
                                                                <th>Amount</th>
                                                            </tr>
                                                            <tbody id="tbl_sum_details">
                                                            </tbody>
                                                        </table>
                                                    </div>
                                                </div>

                                                <div class="row">
                                                    <div class="col-sm-4 col-xs-12">
                                                    </div>
                                                    <div class="col-sm-4 col-xs-12">
                                                        <label class="control-label">Total SPrice</label>
                                                        <input value="0" id="Tselling" class="form-control" readonly />
                                                    </div>
                                                    <div class="col-sm-4 col-xs-12">
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <div id="yoghurtStatement" class="tab-pane fade">
                                    <div class="tab-ctn">
                                        <div class="normal-table-list mg-t-30">
                                            <div class="row">
                                                <div class="col-sm-4 col-xs-12">
                                                    <a id="showSummery" class="btn btn-warning">Show</a>
                                                </div>
                                                <div class="col-sm-4 col-xs-12">
                                                    <a id="excel_summery" class="btn btn-success">Export Excel</a>
                                                </div>
                                            </div>

                                            <div class="bsc-tbl-hvr table-border-style">
                                                <div class="table-responsive">
                                                    <div class="divScroll">
                                                        <table class="table table-hover" id="tbl_summary">
                                                            <tr>
                                                                <th>Date</th>
                                                                <th>Code</th>
                                                                <th>Product</th>
                                                                <th>SNo</th>
                                                                <th>Quantity</th>
                                                                <th>Amount</th>
                                                            </tr>
                                                            <tbody id="tbl_sum_details">
                                                            </tbody>
                                                        </table>
                                                    </div>
                                                </div>

                                                <div class="row">
                                                    <div class="col-sm-4 col-xs-12">
                                                    </div>
                                                    <div class="col-sm-4 col-xs-12">
                                                        <label class="control-label">Total SPrice</label>
                                                        <input value="0" id="Tselling" class="form-control" readonly />
                                                    </div>
                                                    <div class="col-sm-4 col-xs-12">
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <div id="tankerStatement" class="tab-pane fade">
                                    <div class="tab-ctn">
                                        <div class="normal-table-list mg-t-30">
                                            <div class="row">
                                                <div class="col-sm-4 col-xs-12">
                                                    <a id="showSummery" class="btn btn-warning">Show</a>
                                                </div>
                                                <div class="col-sm-4 col-xs-12">
                                                    <a id="excel_summery" class="btn btn-success">Export Excel</a>
                                                </div>
                                            </div>

                                            <div class="bsc-tbl-hvr table-border-style">
                                                <div class="table-responsive">
                                                    <div class="divScroll">
                                                        <table class="table table-hover" id="tbl_summary">
                                                            <tr>
                                                                <th>Date</th>
                                                                <th>Code</th>
                                                                <th>Product</th>
                                                                <th>SNo</th>
                                                                <th>Quantity</th>
                                                                <th>Amount</th>
                                                            </tr>
                                                            <tbody id="tbl_sum_details">
                                                            </tbody>
                                                        </table>
                                                    </div>
                                                </div>

                                                <div class="row">
                                                    <div class="col-sm-4 col-xs-12">
                                                    </div>
                                                    <div class="col-sm-4 col-xs-12">
                                                        <label class="control-label">Total SPrice</label>
                                                        <input value="0" id="Tselling" class="form-control" readonly />
                                                    </div>
                                                    <div class="col-sm-4 col-xs-12">
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <div id="aiStatement" class="tab-pane fade">
                                    <div class="tab-ctn">
                                        <div class="normal-table-list mg-t-30">
                                            <div class="row">
                                                <div class="col-sm-4 col-xs-12">
                                                    <a id="showSummery" class="btn btn-warning">Show</a>
                                                </div>
                                                <div class="col-sm-4 col-xs-12">
                                                    <a id="excel_summery" class="btn btn-success">Export Excel</a>
                                                </div>
                                            </div>

                                            <div class="bsc-tbl-hvr table-border-style">
                                                <div class="table-responsive">
                                                    <div class="divScroll">
                                                        <table class="table table-hover" id="tbl_summary">
                                                            <tr>
                                                                <th>Date</th>
                                                                <th>Code</th>
                                                                <th>Product</th>
                                                                <th>SNo</th>
                                                                <th>Quantity</th>
                                                                <th>Amount</th>
                                                            </tr>
                                                            <tbody id="tbl_sum_details">
                                                            </tbody>
                                                        </table>
                                                    </div>
                                                </div>

                                                <div class="row">
                                                    <div class="col-sm-4 col-xs-12">
                                                    </div>
                                                    <div class="col-sm-4 col-xs-12">
                                                        <label class="control-label">Total SPrice</label>
                                                        <input value="0" id="Tselling" class="form-control" readonly />
                                                    </div>
                                                    <div class="col-sm-4 col-xs-12">
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    @{
        await Html.RenderPartialAsync("_ValidationScriptsPartial");
    }
    <script type="text/javascript">
        $(function () {
            $(".chzn-select").chosen();
            let incomes = new Array();
            let expenses = new Array();
            let totalKgs = 0;
            var today = new Date().toISOString().split('T')[0];
            $("#fromDate").val(today);
            $("#toDate").val(today);
            $('#btn_general_detailed').on('click', function () {
                buildGeneralDetailedStat();
            });
            $('#btn_gen_stat_summary').on('click', function () {
                buildGeneralSummaryStat();
            });

            //$('#excel_summery').on('click', function () {
            //    let date = new Date().toLocaleDateString('en-GB');
            //    let fileName = `Cash Summery ${date}`;
            //    $('#tbl_summary').table2excel({ filename: fileName, fileext: ".xls" });
            //});
            
            //$('#fromDate').on('change', function () {
            //    buildIncomeStatement();
            //});

            //$('#toDate').on('change', function () {
            //    buildIncomeStatement();
            //});

            function buildGeneralDetailedStat() {
                var fromDate = $("#fromDate").val();
                var toDate = $("#toDate").val();
                var filter = {
                    fromDate: fromDate,
                    toDate: toDate,
                };

                if (fromDate && toDate) {
                    $.ajax({
                        type: 'POST',
                        url: "incomeStatement",
                        contentType: 'application/json',
                        data: JSON.stringify(filter),
                        success: function (response) {
                            incomes = response.income ? response.income : new Array();
                            expenses = response.expenses ? response.expenses : new Array();
                            totalKgs = response.totalKgs ? response.totalKgs : 0;
                            populateGeneralDetailsTable();
                        },
                        failure: function (response) {
                        }
                    }).then(function () {
                        // ...
                    });
                }
            }

            function buildGeneralSummaryStat() {
                var fromDate = $("#fromDate").val();
                var toDate = $("#toDate").val();
                var filter = {
                    fromDate: fromDate,
                    toDate: toDate,
                };

                if (fromDate && toDate) {
                    $.ajax({
                        type: 'POST',
                        url: "incomeStatementSummary",
                        contentType: 'application/json',
                        data: JSON.stringify(filter),
                        success: function (response) {
                            incomes = response.income ? response.income : new Array();
                            expenses = response.expenses ? response.expenses : new Array();
                            totalKgs = response.totalKgs ? response.totalKgs : 0;
                            populateGenaralSummaryTable();
                        },
                        failure: function (response) {
                        }
                    }).then(function () {
                        // ...
                    });
                }
            }

            function populateGeneralDetailsTable() {
                let itemTableRows = new Array();
                var income = 0;
                var expense = 0;
                var dr = 0;
                var cr = 0;
                itemTableRows.push(`<tr>
                    <td colspan="6"><h3>Income</h3></td>
                </tr>`);

                incomes.forEach(j => {
                    debugger
                    j.TransDate = j.TransDate ? j.TransDate : "";
                    itemTableRows.push(`<tr>
                        <td>${j.TransDate}</td>
                        <td>${j.GlAcc}</td>
                        <td>${j.AccName}</td>
                        <td>${j.TransDescript}</td>
                        <td>${j.Dr}</td>
                        <td>${j.Cr}</td>
                    </tr>`);
                    dr += j.Dr;
                    cr += j.Cr;
                });

                itemTableRows.push(`<tr>
                    <td colspan="4"><h3></h3></td>
                    <td>${dr}</td>
                    <td>${cr}</td>
                </tr>`);

                income = income + (cr - dr);
                itemTableRows.push(`<tr>
                    <td colspan="5"><h3>Total Income</h3></td>
                    <td>${income}</td>
                </tr>`);

                dr = 0;
                cr = 0;
                itemTableRows.push(`<tr>
                    <td colspan="6"><h3>Expense</h3></td>
                </tr>`);

                expenses.forEach(j => {
                    j.TransDate = j.TransDate ? j.TransDate : "";
                    itemTableRows.push(`<tr>
                        <td>${j.TransDate}</td>
                        <td>${j.GlAcc}</td>
                        <td>${j.AccName}</td>
                        <td>${j.TransDescript}</td>
                        <td>${j.Dr}</td>
                        <td>${j.Cr}</td>
                    </tr>`);
                    dr += j.Dr;
                    cr += j.Cr;
                });

                itemTableRows.push(`<tr>
                    <td colspan="4"><h3></h3></td>
                    <td>${dr}</td>
                    <td>${cr}</td>
                </tr>`);

                expense = expense + (dr - cr);
                itemTableRows.push(`<tr>
                    <td colspan="5"><h3>Total Expenses</h3></td>
                    <td>${expense}</td>
                </tr>`);

                var profit = income - expense;
                itemTableRows.push(`<tr>
                    <td colspan="5"><h3>Profit/Loss</h3></td>
                    <td>${profit}</td>
                </tr>`);

                itemTableRows.push(`<tr>
                    <td colspan="5"><h3>TOTAL LITRES</h3></td>
                    <td>${totalKgs}</td>
                </tr>`);

                var rate = profit / totalKgs;
                itemTableRows.push(`<tr>
                    <td colspan="5"><h3>MAXIMUM POSSIBLE RATE</h3></td>
                    <td>${rate.toFixed(2)}</td>
                </tr>`);

                $('#general_detailed').html(itemTableRows);
            }

            function populateGenaralSummaryTable() {
                let itemTableRows = new Array();
                var income = 0;
                var expense = 0;
                var amount = 0;
                itemTableRows.push(`<tr>
                    <td colspan="4"><h3>Income</h3></td>
                </tr>`);
                incomes.forEach(j => {
                    itemTableRows.push(`<tr>
                        <td>${j.Name}</td>
                        <td>${j.Quantity}</td>
                        <td>${j.Price}</td>
                        <td>${j.Amount}</td>
                    </tr>`);
                    amount += j.Amount;
                });

                itemTableRows.push(`<tr>
                    <td colspan="3"><h3></h3></td>
                    <td>${amount}</td>
                </tr>`);

                itemTableRows.push(`<tr>
                    <td colspan="4"><h3>Expense</h3></td>
                </tr>`);

                expenses.forEach(j => {
                    itemTableRows.push(`<tr>
                        <td colspan="4">${j.Categoy}</td>
                    </tr>`);
                    j.voteheads.forEach(v => {
                        itemTableRows.push(`<tr>
                            <td>${v.AccNo}</td>
                            <td colspan="2">${v.Name}</td>
                            <td>${v.Amount}</td>
                        </tr>`);
                    });
                    itemTableRows.push(`<tr>
                        <td colspan="3"><h3></h3></td>
                        <td>${j.Total}</td>
                    </tr>`);
                    expense += j.Total;
                });

                itemTableRows.push(`<tr>
                    <td colspan="3"><h3>Total Expenses</h3></td>
                    <td>${expense}</td>
                </tr>`);

                var profit = income - expense;
                itemTableRows.push(`<tr>
                    <td colspan="3"><h3>Profit/Loss</h3></td>
                    <td>${profit}</td>
                </tr>`);

                itemTableRows.push(`<tr>
                    <td colspan="3"><h3>TOTAL LITRES</h3></td>
                    <td>${totalKgs}</td>
                </tr>`);

                var rate = profit / totalKgs;
                itemTableRows.push(`<tr>
                    <td colspan="3"><h3>MAXIMUM POSSIBLE RATE</h3></td>
                    <td>${rate.toFixed(2)}</td>
                </tr>`);

                $('#gen_rep_summary').html(itemTableRows);
            }
        });
    </script>
}
